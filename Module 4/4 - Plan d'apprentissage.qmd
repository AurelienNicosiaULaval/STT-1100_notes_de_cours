---
title: "Module 4 - Plan d'apprentissage"
subtitle: "STT-1100 Introduction Ã  la science des donnÃ©es"
format:
  html:
    toc: true
    toc-title: Plan
    self-contained: true
    link-external-newwindow: true
#    number-sections: true
    css: [../css/base_css.css]
editor: visual
---

# Objectifs du module

Ã€ la fin de ce module, vous devriez Ãªtre capable de

- Importer des donnÃ©es de diffÃ©rents formats (`txt`, `csv`, `excel`, `json`).
- Nettoyer et recoder des donnÃ©es pour assurer leur qualitÃ©.
- Utiliser les librairies `forcats` et `stringr` pour manipuler des facteurs et des chaÃ®nes de caractÃ¨res.
- CrÃ©er et utiliser des listes.

# Lectures initiales

## ğŸ“˜ Lectures Ã  faire avant lâ€™aventure

Dans ce module, nous allons explorer les concepts de base de l'importation et du nettoyage de donnÃ©es. Voici quelques lectures initiales pour vous prÃ©parer :


-   [**R for Data Science â€“ Data import**](https://r4ds.hadley.nz/data-import.html){target="_blank"}\
    Ce chapitre vous introduit Ã  lâ€™importation de donnÃ©es avec le package `readr`.\
    
    
-   [**R for Data Science â€“ Data tidying**](https://r4ds.hadley.nz/data-tidy.html){target="_blank"}\
    Ce chapitre vous introduit Ã  la manipulation de donnÃ©es avec le package `dplyr`.\
   
    
-   [**R for Data Science â€“ Factors**](https://r4ds.hadley.nz/factors.html){target="_blank"}\
    Ce chapitre vous introduit aux **facteurs** en R, qui sont des variables catÃ©goriques.\
    \> ğŸ“ **Note** : Bien que ce chapitre soit plus largement utilisÃ© au module 4, certaines fonctions utiles comme `factor()` ou `fct_reorder()` peuvent dÃ©jÃ  vous aider pour manipuler des variables catÃ©goriques (module 3).
    
-   [**R for Data Science â€“ Import spreadsheets**](https://r4ds.hadley.nz/spreadsheets.html){target="_blank"}\
    Ce chapitre vous introduit Ã  lâ€™importation de donnÃ©es Ã  partir de fichiers Excel.\
   

-   [**R for Data Science â€“ Lists**](https://r4ds.hadley.nz/rectangling.html#lists){target="_blank"}\
    Cette section vous introduit au concept de liste en programmation. \
    

# Aventure

[Aventure 4](Aventure/Aventure%204.qmd)

# DÃ©fi

A la fin de l'aventure, vous devez Ãªtre en mesure d'avoir dÃ©poser dans votre dossier Github les Ã©lÃ©ments suivants :

- le script `.qmd` de votre aventure, c'est Ã  dire un document ou vous faites vos tests et construisez votre liste journal_nettoyage ;

- la liste `journal_nettoyage` dans un objet `.Rdata` ;

- la base de donnÃ©es nettoyÃ©e au format `.csv.`

# ğŸ“ Exercices de consolidation


### Exercice 1 â€“ Lecture contrÃ´lÃ©e dâ€™un CSV  (Data import, Â§ readr)
Importez `policies.csv` en :

- forÃ§ant `policy_id` en **character** ;

- laissant `premium_amount` en **double**  

puis affichez la structure de lâ€™objet.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse

```r
library(readr)

policies <- read_csv(
  "policies.csv",
  col_types = cols(
    policy_id      = col_character(),
    premium_amount = col_double()
  )
)
glimpse(policies)
```
:::



### Exercice 2 â€“ Nettoyage des valeurs manquantes  (Data import, ex. 4)
Le fichier contient la chaÃ®ne `"missing"` pour indiquer une absence dans `vehicle_type`.  
RÃ©-importez le fichier en la convertissant en `NA`.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse
```r
policies <- read_csv("policies.csv", na = "missing")
```
:::



### Exercice 3 â€“ Passage long â†” large  (Data tidy, Â§ pivot)
Les colonnes `q1_claims:q4_claims` reprÃ©sentent le nombre de rÃ©clamations par trimestre.  

1. Mettez-les en *long* (`quarter`, `claims`).  

2. Revenez ensuite en *wide*.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse

```r
library(tidyr)
library(dplyr)

pol_long <- policies %>% 
  pivot_longer(
    cols = q1_claims:q4_claims,
    names_to  = "quarter",
    values_to = "claims"
  )

pol_wide <- pol_long %>% 
  pivot_wider(names_from = quarter, values_from = claims)
```
:::



### Exercice 5 â€“ Lire une feuille Excel prÃ©cise  (Import spreadsheets, ex. 3)
Le classeur `quotes_2024.xlsx` possÃ¨de une feuille Â« Q3 Â» oÃ¹ les libellÃ©s commencent Ã  la 2áµ‰ ligne.  
Importez-la et vÃ©rifiez les types.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse

```r
library(readxl)

q3 <- read_excel(
  "quotes_2024.xlsx",
  sheet = "Q3",
  skip  = 1   # on saute la premiÃ¨re ligne
)
glimpse(q3)
```
:::


### Exercice 6 â€“ Parse de nombres avec locale  (Data import, ex. 5)
La colonne `euro_premium` contient Â« 1 234,56 Â» (virgule dÃ©cimale, espace 000).  
Parsez-la correctement en `double`.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse

```r
library(readr)

parse_number("1 234,56", locale = locale(decimal_mark = ",", grouping_mark = " "))
```
:::


### Exercice 7 â€“ Rectangling dâ€™une liste JSON  (Lists, ex. 1-2)
Vous disposez dâ€™une liste `lst <- jsonlite::read_json("coverage.json")`.  

1. RÃ©cupÃ©rez `lst$collision$limit`.  

2. Transformez `lst` en tibble rectangulaire.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse

```r
library(jsonlite)
library(tidyr)
library(dplyr)

lst   <- read_json("coverage.json")
limit <- lst$collision$limit

tbl <- tibble(row = lst) %>% 
  unnest_wider(row)
```
:::


### Exercice 8 â€“ Pipeline express  (SynthÃ¨se)
En trois lignes :  

1. importez `policies.csv` ;  

2. nettoyez les noms (`janitor::clean_names`) ;  

3. renvoyez les **5** plus grosses `claim_amount` par `vehicle_type`.

::: {.callout-note collapse="true"}
### âœ… RÃ©ponse```r
library(readr); library(dplyr); library(janitor)

read_csv("policies.csv") %>% 
  clean_names() %>% 
  slice_max(claim_amount, n = 5, by = vehicle_type)
```
:::




