---
title: "Aventure 2 - Github et la visualisation de données numériques"
subtitle: "STT-1100"
editor: visual
editor_options: 
  chunk_output_type: console
format:
  html:
    toc: true
    self-contained: true
     toc-title: Plan
    number-sections: true
    css: style.css
---

```{r setup, echo=FALSE, message=FALSE, warning=FALSE}
library(palmerpenguins)
library(tidyverse)


#Voici les modifications que j'ai apportées au jeu de données des manchots pour cette aventure :
#penguins[c( 11), c("body_mass_g", "bill_length_mm")]

#Ajout d'une valeur aberrante sur une seule variable :
#Un individu a une longueur de nageoire (flipper_length_mm) de 400 mm, ce qui est bien au-delà de la normale.
#Ajout d'une valeur aberrante sur deux variables :
#Un individu a une masse corporelle (body_mass_g) de 9000 g et une longueur de bec (bill_length_mm) de 20 mm, une combinaison incohérente.

library(UlavalSSD)
```

# Comment réussir cette aventure {.unnumbered}

Bienvenue dans cette nouvelle aventure en science des données ! Cette fois, vous allez collaborer avec une chercheuse qui étudie les manchots de la station Palmer en Antarctique. Votre mission est d’explorer et d’analyser ses données pour l’aider à répondre à ses questions scientifiques.

Pour réussir cette aventure, voici quelques conseils essentiels :

-   **Lisez attentivement chaque section** avant de passer à l’expérimentation. Les explications fournies vous permettront de bien comprendre les concepts et les outils utilisés.\
-   **Expérimentez activement** en exécutant le code proposé et en l’adaptant à vos propres analyses. Modifier et tester différentes approches est un excellent moyen d’apprendre.\
-   **Réfléchissez aux questions posées par la chercheuse** et utilisez les outils adéquats pour y répondre. Pensez à justifier vos choix et interprétations.\
-   **Soyez rigoureux** dans votre travail en adoptant de bonnes pratiques de programmation et en documentant vos analyses.\
-   **N’hésitez pas à poser des questions** si vous rencontrez des difficultés ou si certains concepts restent flous.

Cette aventure vous permettra de développer vos compétences en manipulation, visualisation et analyse de données avec `dplyr` et `ggplot2`. Ce sont des compétences primordiales pour un scientifique de données. Prenez le temps d’explorer les différentes étapes et amusez-vous à apprendre !

# 🚀 Travail sur Github

La chercheuse a préparé un dépôt sur GitHub où elle souhaite que vous enregistriez tout votre travail. De son côté, elle y a déposé la base de données qu’elle a collectée ainsi qu’une description détaillée des variables.

Avant de commencer l'analyse des données, vous devez récupérer le dépôt GitHub contenant les fichiers nécessaires.

1️⃣ Clonez le dépôt "Aventure-2-IDENTIFIANT_GITHUB".

2️⃣ Créez un environnement de travail propre: Une fois le dépôt cloné, ouvrez RStudio et assurez-vous que vous êtes bien dans le dossier du projet.

💡 Astuce : Si vous souhaitez revenir plus tard sur ce projet, vous pouvez ouvrir directement le projet en double-cliquant sur le fichier `.Rproj` dans votre explorateur de fichiers.

3️⃣ Créer un fichier Quarto: Les fichiers d'analyse ne sont pas encore présents dans le dépôt. Vous devez créer un nouveau document Quarto (`.qmd`) pour effectuer vos analyses. Dans RStudio :

4️⃣ Premier commit et push vers GitHub: Une fois votre fichier `.qmd` créé et enregistré, commitez et poussez vos modifications sur GitHub :

Attention: on se rappelle que les messages de commit doivent être parlant. Par exemple "Ajout du fichier d'analyse initial"

🎯 Félicitations ! Vous êtes maintenant prêt à débuter l’analyse scientifique des manchots ! 🐧🚀

# 📂 Lecture des données

La chercheuse vous a fourni un fichier Excel contenant les données des manchots qu’elle a collectées. Votre première mission consiste à **charger ces données dans R** en utilisant l’interface graphique de RStudio.

**🔹 Étapes à suivre**

1.  **Ouvrir le menu d’importation de données**

    -   Dans RStudio, allez dans l’onglet **Environment** (Environnement).

    -   Cliquez sur **Import Dataset** (Importer un jeu de données).

    -   Sélectionnez **From Excel...** (Depuis Excel...), puisque l'extension est un `.xlsx`

![](image/bouton_import_data.png){fig-align="center"}

1.  **Sélectionner le fichier**

    -   Dans la fenêtre qui s’ouvre, cliquez sur **Browse...** (Parcourir...) et sélectionnez le fichier **`.xlsx`** que vous avez téléchargé via le clonage du dépôt.

2.  **Ajuster les paramètres d’importation**

    -   Assurez-vous que les en-têtes de colonnes sont bien détectées.

    -   Vérifiez que toutes les variables sont correctement identifiées (ex. les nombres sont bien en format numérique).

    -   On appelera le jeu de données `penguins_mission`, compléter l'information dans la fenêtre.

3.  **Importer et afficher les données**

    -   Cliquez sur **Import**.

    -   Vérifiez que votre jeu de données apparaît dans l’**Environment** sous le nom `penguins_mission`.

    *Remarque*: lorsque on clique sur **Import,** un code s'execute dans la console. Il s'agit du code pour importer le jeu de données.

    -   Pour voir un aperçu des données, utilisez la commande suivante dans la console :

        `View(penguins_mission)`

📝 **Rappel : documentez votre importation dans votre rapport Quarto**

Une bonne pratique en science des données est de toujours **documenter** comment vous avez importé les données, même si vous avez utilisé une interface graphique.\
Ajoutez le code exécuté dans la console dans votre fichier **Quarto** d'analyse **(`.qmd`)**.

Vous devriez avoir une première section **Lecture des données,** avec un bloc de code qui contient le code qui permet de lire les données.J'en profite pour vous rappeler les **bonnes pratiques de programmation du Tidyverse**, à savoir que dans votre bloc de code, il devrait par exemple y avoir des commentaires.

💡 **Pourquoi est-ce important ?**\
Cela garantit que votre analyse est **reproductible** : si un autre chercheur veut la refaire, il pourra exécuter votre code sans avoir à utiliser l’interface graphique.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(readxl)  # Chargement du package pour lire Excel

# Importation des données
penguins_mission <- read_excel("manchots_donnees.xlsx")

```

**📌 Une fois vos données chargées, vous êtes prêts à les explorer et à les analyser 🐧! Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

# 🛠️ Manipulation de données

## Résumé de données avec `glimpse()`

La chercheuse veut une vue rapide des données pour vérifier leur structure. Utilisez `glimpse()` pour afficher un aperçu :

```{r, eval=FALSE}
library(tidyverse)
glimpse(penguins_mission)
```

La chercheuse souhaite obtenir un premier compte rendu sur les données disponibles. Pour cela, vous devez compléter le texte suivant et l'intégrer dans votre rapport d'analyse Quarto :

> "Le jeu de données contient \*\*\_\_\_\*\* observations et \*\*\_\_\_\*\* variables. Les variables sont ***,*** , \*\*\_\_\_\*\*....etc"

💡 **Question de réflexion** : Que se passe-t-il si la chercheuse modifie la base de données ? Par exemple, elle a oublié un manchot et l'ajoute sans vous prévenir, puis met à jour le dépôt GitHub. Lorsque vous réexécutez votre analyse dans votre rapport Quarto (`.qmd`), que va-t-il se passer ? 🤔

Ne vous inquiétez pas si cela vous semble complexe ! Nous reviendrons sur cet aspect plus tard dans la session. 😉

::: exercise
📝 **Exercice** : Combien de variables sont de type numérique? Combien de type charactère?

*to-do*: Inclure votre réponse dans votre rapport d'analyse à la suite du texte troué.
:::

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

## Sélectionner des variables avec `select()`

La chercheuse veut se concentrer uniquement sur certaines variables pertinentes pour son analyse. Utilisez `select()` pour ne garder que `species`, `island`, `bill_length_mm` et `body_mass_g` :

```{r, eval=FALSE}
penguins_subset <- penguins_mission %>% 
  select(species, island, bill_length_mm, body_mass_g)
```

💡 **Pourquoi est-ce important de changer de nom de jeu de données dans l'environnement?**

::: experimentation
**Expérimentation**: Faite un `glimpse()` de la nouvelle base de données `penguins_subset`. Pourquoi avoir choisi un nouveau nom?
:::

::: exercise
📝 **Exercice** : Sélectionnez toutes les variables sauf `flipper_length_mm` et `body_mass_g`. Attention il y a une facon rapide de le faire!
:::

## Créer de nouvelles variables avec `mutate()`

💡 **Explication** : La chercheuse souhaite ajouter une nouvelle colonne indiquant le poids en kilogrammes au lieu de grammes. En effet, son appareil de mesure indiquait les mesures en g, mais elle croit que cela sera plus facile à interpréter en kg.

💡 **Pourquoi est-ce utile ?** Transformer les unités peut faciliter la compréhension et la communication des résultats.

La chercheuse souhaite ajouter une nouvelle colonne indiquant le poids en kilogrammes au lieu de grammes. Utilisez `mutate()` pour créer cette nouvelle variable :

```{r eval=FALSE}
penguins_mission <- penguins_mission %>% 
  mutate(body_mass_kg = body_mass_g / 1000)
```

::: exercise
📝 **Exercice** : Créez une nouvelle variable appelée `bill_ratio` correspondant au rapport entre la longueur et la profondeur du bec.
:::

```{r echo=FALSE}
penguins_mission <- penguins_mission %>% 
  mutate(ratio = bill_length_mm/bill_depth_mm)
```

🧐 **Question de la chercheuse** : un de mes collègues en antartique m'assure que le rapport **moyen** entre la longueur et la profondeur du bec est superieur à 3. De mon côté, je trouve cela étrange, car ca ne respecte pas ce qu'on peut lire dans la littérature. Peux-tu m'aider avec cela? j'aimerai que tu répondes à la question dans le rapport.

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

## Filtrer les données avec `filter()`

La chercheuse veut analyser uniquement les manchots de l’île **Biscoe**. Utilisez `filter()` pour ne garder que ces observations :

```{r eval=FALSE}
penguins_biscoe <- penguins_mission %>% 
  filter(island == "Biscoe")
```

::: exercise
📝 **Exercice** : Filtrez les données pour ne garder que les manchots de l’espèce **Adelie** de l'île Biscoe.
:::

## Regrouper et résumer les données avec `group_by()`

La chercheuse souhaite connaître la masse moyenne des manchots par espèce. Utilisez `group_by()` suivi de `summarise()` pour obtenir cette information :

```{r eval=FALSE}
penguins_summary <- penguins_mission %>% 
  group_by(species) %>% 
  summarise(mean_body_mass_g = mean(body_mass_g, na.rm = TRUE))
```

🧐 **Question de la chercheuse** : Quelle est la combinaison île/espèce qui possède la longueur médiane de nageoire la plus faible ? j'aimerai que tu répondes à la question dans le rapport.

Grâce à `group_by` on peut aussi par exemple filter par groupe, ce qui peut être très pratique!

::: exercise
📝 **Exercice** : Faites sortir le premier manchot de la base de données pour chaque espèce et chaque île. *Indice:* on peut utiliser la fonction `top_n`.
:::

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

# 🐧 Un appel d'urgence depuis l'Antarctique

Alors que vous avanciez bien dans votre analyse des données, vous recevez un message urgent de la chercheuse. Elle a dû partir précipitamment en Antarctique pour une mission d'urgence : aider une colonie de manchots confrontée à des conditions climatiques extrêmes.

Avant son départ, elle a pris soin de vous laisser une liste de tâches essentielles à compléter. Elle compte sur vous pour poursuivre son analyse ! Cependant, la connexion est instable là-bas, et la seule manière de communiquer avec elle est par message en **R**.

💡 **Bonne nouvelle !** Elle vous a fourni une fonction R qui vous permet de lui voir la liste des tâches et de lui poser des questions. Les fonctions se trouvent dans la librairie `UlavalSSD` que l'on utilise dans ce cours.

# 📊 Visualisation des données

La visualisation des données est une étape essentielle de l'analyse, car elle permet de mieux comprendre les tendances et les relations entre les variables. Une bonne visualisation facilite l'interprétation des données et aide à repérer des valeurs aberrantes ou des motifs intéressants.

💡 **Rappel des bonnes pratiques de codage en visualisation** :

-   Toujours **étiqueter** les axes avec `labs()` pour rendre les graphiques compréhensibles.

-   Utiliser des **couleurs adaptées** pour distinguer les groupes sans surcharger la visualisation.

-   Vérifier que l'échelle des axes est cohérente et ne fausse pas l'interprétation des données.

-   Adapter le **binwidth** des histogrammes et la **transparence** des points dans les graphiques de nuage de points pour éviter une mauvaise lisibilité.

-   Tester plusieurs types de graphiques avant de conclure sur une analyse.

## Histogrammes

💡 **Explication** : Un histogramme permet de visualiser la distribution d'une variable numérique. Ici, nous allons par exemple examiner la répartition des profondeurs de bec (`bill_depth_mm`).

```{r}
library(ggplot2)
ggplot(penguins_mission, aes(x = bill_depth_mm)) +
  geom_histogram(binwidth = 0.5, fill = "steelblue", color = "black") +
  labs(title = "Distribution de la longueur du bec des manchots",
       x = "Longueur du bec (mm)",
       y = "Effectif")
```

::: experimentation
💡 **Expérimentation** : Changez la valeur de `binwidth` dans le code ci-dessus et observez comment cela modifie l'histogramme.
:::

**📜 Instructions laissées par la chercheuse**

Pour connaître la première demande de la chercheuse, utilisez la fonction :

```{r eval=FALSE}
consulter_taches("histogramme")
```

::: exercise
📝 **Exercice** : Créez un histogramme pour la variable `flipper_length_mm`. Vous devez ajuster l'ensemble des informations sur le graphique en respectant les bonnes pratiques de visualisation.
:::

🧐 **Question de la chercheuse** : En regardant l'histogramme de la longueur des nageoires, remarquez-vous quelque chose de particulière dans la distribution ?

Poussons un peu plus loin la visualisation pour essayer de répondre à sa demande.

## Boite à moustache

💡 **Explication** : Une boîte à moustaches permet de visualiser la dispersion d'une variable numérique et d'identifier d'éventuelles valeurs aberrantes. Ici, nous allons examiner la distribution de la longueur des nageoires (`flipper_length_mm`).

```{r}
ggplot(penguins_mission, aes(x = species, y = flipper_length_mm, fill = species)) +
  geom_boxplot() +
  labs(title = "Distribution de la longueur des nageoires par espèce",
       x = "Espèce",
       y = "Longueur des nageoires (mm)")
```

::: experimentation
💡 **Expérimentation** : Ajoutez une variable de couleur pour différencier les îles et observez si certaines îles présentent des valeurs plus extrêmes.
:::

::: exercise
📝 **Exercice** : Trouvez le numéro de ligne de l'observation qui semble être une valeur aberrante dans la longueur des nageoires.
:::

🧐 **Question de la chercheuse** : Avez-vous trouvé l'observation aberrante ? Utilisez la fonction `verifier_valeur_aberrante` pour lui répondre. Vous devez entrer le numéro de la ligne que vous pensez être aberrante.

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

## Nuages de point (scatter plot)

💡 **Explication** : Un scatter plot (ou nuage de points) permet de visualiser la relation entre deux variables numériques. Ici, nous allons examiner la relation entre la longueur du bec (`bill_length_mm`) et la profondeur du bec (`bill_depth_mm`).

```{r}
ggplot(penguins_mission, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() +
  labs(title = "Relation entre la longueur et la profondeur du bec",
       x = "Longueur du bec (mm)",
       y = "Profondeur du bec (mm)")
```

::: experimentation
💡 **Expérimentation** : Ajoutez une variable de couleur pour différencier les îles et observez si certaines îles présentent des relations différentes.
:::

Pour connaître la prochaine demande de la chercheuse, utilisez la fonction :

```{r eval=FALSE}
consulter_taches("nuage_de_points")
```

::: exercise
📝 **Exercice** : Modifiez le scatter plot pour afficher la relation souhaitée par la chercheuse.
:::

🧐 **Question de la chercheuse** : J'ai remarqué une valeur étrange qui semble aberrante pour les deux variables. Pouvez-vous identifier l'observation concernée ? Trouvez son numéro de ligne et utilisez la fonction `verifier_valeur_aberrante`.

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

# 🧮 Statistiques descriptives

💡 **Explication** : Les statistiques descriptives permettent de résumer et comprendre rapidement un ensemble de données. Elles se divisent en plusieurs catégories :

-   **📌 Tendance centrale** : moyenne, médiane
-   **📌 Dispersion** : variance, écart-type, coefficient de variation
-   **📌 Distribution** : min, max, quartiles
-   **📌 Asymétrie et aplatissement** : skewness et kurtosis (optionnel)

Nous allons voir comment obtenir ces statistiques en R avec `dplyr`. En utilisant la fonction `summarise` il est très facile de calculer des statistiques descriptives sur une variable:

```{r eval=FALSE}
penguins %>%
  summarise(
    mean_bill_length = mean(bill_length_mm, na.rm = TRUE), #  moyenne
    median_bill_length = median(bill_length_mm, na.rm = TRUE), # mediane
    sd_bill_length = sd(bill_length_mm, na.rm = TRUE), # écart-type
    var_bill_length = var(bill_length_mm, na.rm = TRUE), # variance
    min_bill_length = min(bill_length_mm, na.rm = TRUE), # min
    max_bill_length = max(bill_length_mm, na.rm = TRUE), # max
    q1_bill_length = quantile(bill_length_mm, 0.25, na.rm = TRUE), # Q1
    q3_bill_length = quantile(bill_length_mm, 0.75, na.rm = TRUE) #Q3
  )
```

*Remarque*: on utilise l'option `na.rm=TRUE` dans les fonctions, ce qui est assez pratique, car cela permet de calculer la statistique en omettant les valeurs manquantes (`NA`).

**📜 Instructions laissées par la chercheuse**

Pour connaître la première demande de la chercheuse, utilisez la fonction :

```{r eval=FALSE}
consulter_taches("statistiques_descriptives")
```

::: exercise
📝 **Exercice**: Répondez de facon précise dans votre rapport à la demande du Docteur Adélie.
:::

✅ Méthode rapide avec `across()` ans `dplyr`

Tu peux appliquer toutes les fonctions statistiques sur plusieurs colonnes d'un coup :

```{r eval=FALSE}
penguins_mission %>%
  group_by(species) %>%
  summarise(across(bill_length_mm, list(
    mean = mean, median = median, sd = sd, var = var, 
    min = min, max = max, q1 = ~quantile(.x, 0.25), q3 = ~quantile(.x, 0.75)
  ), na.rm = TRUE))


```

💡 Avantages :

-   Moins de répétition de code

-   Facilement extensible à plusieurs variables en changeant `bill_length_mm` par `c(bill_length_mm, flipper_length_mm)`

## Visualisation avancée et statistiques descriptives

Nous allons maintenant créer un boxplot détaillé qui affiche : - Les quartiles (Q1-Q3) - La médiane - La moyenne - Les valeurs extrêmes

💡 **Question de réflexion** : Parmis les stastiques précédentes, laquelle n'est habituellement pas affichée dans une boite à moustache? 🤔

Avant de partir en antartique, la chercheuse vous as laissé un bout de code (vraisemblablement un début de travail qu'elle souhaitait faire);

```{r eval=TRUE}
ggplot(penguins_mission, aes(x = species, y = bill_length_mm, fill = species)) +
  geom_boxplot(alpha = 0.5) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 4, fill = "red") +
  labs(title = "Longueur du bec des pingouins par espèce",
       x = "Espèce",
       y = "Longueur du bec (mm)") +
  theme_minimal()
```

**📜 Instructions laissées par la chercheuse**

Pour connaître l'avant dernière demande de la chercheuse, utilisez la fonction :

```{r eval=FALSE}
consulter_taches("statistiques_descriptives")
```

::: exercise
📝 **Exercice**: completer le code `ggplot2` du Dr Adélie afin de répondre à sa demande. Inclure cela dans votre rapport d'analyse. Dites en quoi ce graphique avancé peut aider à comprendre mieux nos données.
:::

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

# 🐧 Le retour du Dr Adélie Fortier!

🔎 Après plusieurs mois en Antarctique à observer les manchots, notre chercheuse est de retour avec pleins de nouvelles questions en tête. Elle a remarqué que certaines espèces semblaient avoir des caractéristiques bien distinctes, mais elle aimerait une analyse plus approfondie.

Sa question principale : 👉 Comment les caractéristiques physiques des manchots varient-elles selon les espèces ?

Pour l’aider, vous réaliserez une analyse complète, en mobilisant toutes les compétences acquises dans ce module.

::: exercise
📌 Question 1 : Existe-t-il des différences notables entre les espèces de manchots ?
:::

➡️ Pour y répondre, vous devez explorer les différences entre les caractéristiques physiques des trois espèces.

✅ Tâches :

Calculez la moyenne et l’écart-type des variables suivantes par espèce :

-   Longueur du bec (`bill_length_mm`)

-   Profondeur du bec (`bill_depth_mm`)

-   Longueur des nageoires (`flipper_length_mm`)

-   Masse corporelle (`body_mass_g`)

Affichez les résultats sous forme de tableau clair.

💡 Indice : Utilisez `group_by()` et `summarise()` de `dplyr` pour obtenir ces statistiques.

::: exercise
🔬 Question 2 : Peut-on identifier un indicateur de "*grandeur*" du manchot ?
:::

➡️ La chercheuse aimerait une nouvelle variable qui pourrait représenter la taille globale d’un manchot.

✅ Tâches :

-   Créez une nouvelle variable **`indice_grandeur`** , définie comme la somme de :

    -   La longueur des nageoires (flipper_length_mm)

    -   La longueur du bec (bill_length_mm)

-   Ajoutez cette variable au jeu de données et affichez quelques valeurs pour vérifier son calcul.

💡 Indice : Utilisez `mutate()` pour ajouter la variable à votre data.frame.

::: exercise
🔬 Question 3 : Comment ces caractéristiques sont-elles réparties entre les espèces ?
:::

➡️ Pour mieux visualiser les différences entre les espèces, la chercheuse vous demande de créer des graphiques.

✅ Tâches :

-   Un histogramme de la longueur du bec (`bill_length_mm`) par espèce.

-   Un nuage de points montrant la relation entre **`indice_grandeur`** et la masse corporelle (`body_mass_g`), en colorant par espèce.

Attention, n'oubliez pas vos bonnes pratiques de visualisation.

**✍️ Conclusion**

-   Que remarquez-vous ?

-   Quelles sont les différences les plus marquantes entre les espèces ?

**Pensez à générer votre rapport, committer vos modifications et pousser sur GitHub pour garder une trace de votre travail ! 🚀**

------------------------------------------------------------------------

🎯 **Mission réussie !** Vous avez aidé le Dr Adélie Fortier à analyser les données des manchots avec succès ! 🚀
